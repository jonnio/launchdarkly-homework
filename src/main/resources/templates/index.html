<!doctype html>
<html lang="en" data-bs-theme="light">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Include Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
          rel="stylesheet"
          integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
          crossorigin="anonymous">

    <script type="importmap">
        {
          "imports": {
            "vue": "https://unpkg.com/vue@3/dist/vue.esm-browser.js",
            "axios": "https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js",
            "tabulator": "https://unpkg.com/tabulator-tables@6.2.5/dist/js/tabulator_esm.min.js",
            "ld": "https://cdn.jsdelivr.net/npm/launchdarkly-vue-client-sdk@2.2.2/dist/launchdarkly-vue-client-sdk.es.js"
          }
        }
    </script>

    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

    <script defer src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
            crossorigin="anonymous"></script>

    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/tabulator/6.2.5/css/tabulator_bootstrap5.min.css"
          integrity="sha512-qDEgvDbdp7tq+ytU/OgCzWfvbfdEe3pv0yEOMz/gurMcR0BWNgIF6I4VKeoACEj5E5PFf1uo3Vzuwk/ga9zeUg=="
          crossorigin="anonymous" referrerpolicy="no-referrer"/>

    <title>LD Homework - Osborn</title>
</head>
<body>
<div class="container-fluid">
    <nav class="navbar navbar-expand-lg">
        <a class="navbar-brand" href="#">Osborn LD Homework</a>
    </nav>

    <h3>Olympic Results</h3>
    <p>See the results for each competition since 1896</p>
    <div id="app">

        <div id="medal-table" class="table table-light"></div>

    </div>

</div>
<script type="module">

    import {createApp, ref} from 'vue';
    import {TabulatorFull as Tabulator} from 'tabulator';
    import {LDPlugin, useLDFlag, useLDReady} from 'ld';

    import {ldInit, useLDFlag} from 'launchdarkly-vue-client-sdk'

    // Set clientSideID to your LaunchDarkly client-side ID
    const clientSideID = '66b36d56cd98fb104ad0ad8b'

    // Set up the context properties. This context should appear on your LaunchDarkly
    // contexts dashboard soon after you run the demo.
    const context = {kind: 'user', key: 'feature-olympic-pagination', name: 'Joseph'}

    // Set featureFlagKey to the feature flag key you want to evaluate
    const featureFlagKey = 'feature-olympic-pagination'

    if (!clientSideID) {
        console.warn('Please edit App.vue to set clientSideID to your LaunchDarkly client-side ID')
    }
    const [ldReady] = ldInit({clientSideID, context})
    const flagValue = useLDFlag(featureFlagKey, false)


    const instance = axios.create({
        baseURL: '/api/olympics/',
        timeout: 1000,
        headers: {'Authorization': `Bearer ABCDEF`}
    });

    createApp({
        setup() {
            const msg = ref('Hello vue & [[${ message }]]')
            return {
                msg
            }
        },
        data() {
            return {
                items: []
            };
        },
        mounted() {
            // use LD here
            let version = 1
            if (version === 1) {
                let table = new Tabulator("#medal-table", {
                    height: 650,
                    layout: "fitColumns",
                    pagination: false,
                    columns: [
                        {title: "Year", field: "olympicYear", width: 150, sorter: "number"},
                        {title: "City", field: "city"},
                        {title: "Sport", field: "sport"},
                        {title: "Discipline", field: "discipline"},
                        {title: "Athlete", field: "athlete"},
                        {title: "Country", field: "country"},
                        {title: "Gender", field: "gender"},
                        {title: "Event", field: "event"},
                        {title: "Medal", field: "medal"},
                    ],
                });
                instance
                    .get('/results')
                    .then(response => {
                        //this.items = response.data;
                        table.setData(response.data);
                    })
                    .catch(error => {
                        console.error('Error fetching data:', error);
                    });
            } else if (version === 2) {
                let table = new Tabulator("#medal-table", {
                    height: 650,
                    layout: "fitColumns",
                    pagination: true,
                    paginationMode: "remote",
                    sortMode: "remote",
                    ajaxURL: "/api/olympics/paged/results",
                    dataReceiveParams: {
                        "last_page": "totalPages",
                        "data": "content",
                    },
                    ajaxURLGenerator: function (url, config, params) {
                        return url + "?params=" + encodeURI(JSON.stringify(params)); //encode parameters as a json object
                    },
                    columns: [
                        {title: "Year", field: "olympicYear", width: 150, sorter: "number"},
                        {title: "City", field: "city"},
                        {title: "Sport", field: "sport"},
                        {title: "Discipline", field: "discipline"},
                        {title: "Athlete", field: "athlete"},
                        {title: "Country", field: "country"},
                        {title: "Gender", field: "gender"},
                        {title: "Event", field: "event"},
                        {title: "Medal", field: "medal"},
                    ],
                });
            }
        }
    })
        .use(LDPlugin, {clientSideID: 'client-side-id-123abc', deferInitialization: true})
        .mount('#app');


</script>

</body>
</html>